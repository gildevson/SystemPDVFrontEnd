<!-- ===== OVERLAY DO MODAL DE CADASTRO ===== -->
<div class="overlay" *ngIf="exibirCadastro" (click)="fecharOverlay()">
  <div class="container" (click)="$event.stopPropagation()">
    <app-novo-usuario
      (salvou)="aoSalvarUsuario()"
      (fechar)="fecharOverlay()">
    </app-novo-usuario>
  </div>
</div>

<div class="content-card">

  <!-- ===== HEADER DO CARD ===== -->
  <div class="header-row">
    <h2 class="titulo">Lista de Usuários</h2>

    <button class="btn-novo" (click)="abrirOverlay()">
      <span class="material-icons">person_add</span>
      Novo Usuário
    </button>
  </div>

  <!-- ===== BARRA DE PESQUISA ===== -->
  <div class="search-container">
    <span class="material-icons search-icon">search</span>
    <input
      type="text"
      class="search-input"
      [(ngModel)]="termoPesquisa"
      (input)="pesquisar()"
      placeholder="Pesquisar por nome ou email...">
    <button
      class="btn-limpar"
      *ngIf="termoPesquisa"
      (click)="limparPesquisa()"
      title="Limpar pesquisa">
      <span class="material-icons">close</span>
    </button>
  </div>

  <!-- ===== TABELA DE USUÁRIOS ===== -->
  <table class="tabela">
    <thead>
      <tr>
        <th>Nome</th>
        <th>Email</th>
        <th>Data de Criação</th>
        <th class="col-acoes">Ações</th>
      </tr>
    </thead>

    <tbody>
      <!-- Lista de usuários -->
      <tr *ngFor="let u of usuariosFiltrados">
        <td data-label="Nome">{{ u.nome }}</td>
        <td data-label="Email">{{ u.email }}</td>
        <td data-label="Data de Criação">{{ u.dataCriacao | date:'dd/MM/yyyy HH:mm' }}</td>
        <td class="acoes">
          <span
            class="acao editar material-icons"
            (click)="editar(u)"
            title="Editar usuário">
            edit
          </span>
          <span
            class="acao deletar material-icons"
            (click)="deletar(u)"
            title="Deletar usuário">
            delete
          </span>
        </td>
      </tr>

      <!-- Estado vazio -->
      <tr *ngIf="usuariosFiltrados.length === 0 && !termoPesquisa" class="empty-state">
        <td colspan="4">
          <span class="material-icons" style="font-size: 48px; color: #cbd5e1; margin-bottom: 12px;">
            inbox
          </span>
          <div>Nenhum usuário cadastrado</div>
        </td>
      </tr>

      <!-- Nenhum resultado encontrado -->
      <tr *ngIf="usuariosFiltrados.length === 0 && termoPesquisa" class="empty-state">
        <td colspan="4">
          <span class="material-icons" style="font-size: 48px; color: #cbd5e1; margin-bottom: 12px;">
            search_off
          </span>
          <div>Nenhum resultado encontrado para "{{ termoPesquisa }}"</div>
          <button class="btn-limpar-resultado" (click)="limparPesquisa()">
            Limpar pesquisa
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- ===== PAGINAÇÃO ===== -->
  <div class="paginacao" *ngIf="totalPages > 1 && !termoPesquisa">
    <button
      class="btn-pag"
      [disabled]="page === 1"
      (click)="buscarUsuarios(page - 1)">
      « Anterior
    </button>

    <div class="numeros">
      <button
        *ngFor="let p of [].constructor(totalPages); let i = index"
        class="num"
        [class.ativo]="page === (i + 1)"
        (click)="buscarUsuarios(i + 1)">
        {{ i + 1 }}
      </button>
    </div>

    <button
      class="btn-pag"
      [disabled]="page === totalPages"
      (click)="buscarUsuarios(page + 1)">
      Próxima »
    </button>
  </div>

</div>
