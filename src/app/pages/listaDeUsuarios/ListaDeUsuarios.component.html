<!-- ================= -->
<!-- CARD PRINCIPAL -->
<!-- ================= -->
<div class="content-card">

  <!-- HEADER -->
  <div class="header-row">
    <h2 class="titulo">Lista de Usuários</h2>

    <button
      type="button"
      class="btn-novo"
      (click)="abrirOverlay()">
      <span class="material-icons">person_add</span>
      Novo Usuário
    </button>
  </div>

  <!-- PESQUISA -->
  <div class="search-container">
    <span class="material-icons search-icon">search</span>

    <input
      type="text"
      class="search-input"
      [(ngModel)]="termoPesquisa"
      (input)="pesquisar()"
      placeholder="Pesquisar por nome, email ou permissão..." />

    <button
      *ngIf="termoPesquisa"
      type="button"
      class="btn-limpar"
      title="Limpar pesquisa"
      (click)="limparPesquisa()">
      <span class="material-icons">close</span>
    </button>
  </div>

  <!-- TABELA -->
  <table class="tabela">
    <thead>
      <tr>
        <th>Nome</th>
        <th>Email</th>
        <th>Permissões</th>
        <th>Data de Criação</th>
        <th class="col-acoes">Ações</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let u of usuariosFiltrados">
        <td data-label="Nome">{{ u.nome }}</td>
        <td data-label="Email">{{ u.email }}</td>

        <!-- ✅ EXIBIÇÃO DAS PERMISSÕES COM BADGES -->
        <td data-label="Permissões">
          <div class="permissoes-container">
            <span
              *ngFor="let permissao of u.permissoes"
              [ngClass]="getPermissaoClass(u.permissoes)"
              class="badge-permissao">
              {{ permissao }}
            </span>
            <span
              *ngIf="!u.permissoes || u.permissoes.length === 0"
              class="badge-permissao badge-sem-permissao">
              Sem permissões
            </span>
          </div>
        </td>

        <td data-label="Data de Criação">
          {{ u.dataCriacao | date:'dd/MM/yyyy HH:mm' }}
        </td>
        <td class="acoes">
          <span
            class="acao editar material-icons"
            title="Editar usuário"
            (click)="editar(u)">
            edit
          </span>

          <span
            class="acao deletar material-icons"
            title="Deletar usuário"
            (click)="deletar(u)">
            delete
          </span>
        </td>
      </tr>

      <!-- ESTADO VAZIO -->
      <tr
        *ngIf="usuariosFiltrados.length === 0 && !termoPesquisa"
        class="empty-state">
        <td colspan="5">
          <span class="material-icons empty-icon">inbox</span>
          <div>Nenhum usuário cadastrado</div>
        </td>
      </tr>

      <!-- SEM RESULTADOS -->
      <tr
        *ngIf="usuariosFiltrados.length === 0 && termoPesquisa"
        class="empty-state">
        <td colspan="5">
          <span class="material-icons empty-icon">search_off</span>
          <div>
            Nenhum resultado encontrado para
            <strong>"{{ termoPesquisa }}"</strong>
          </div>
          <button
            type="button"
            class="btn-limpar-resultado"
            (click)="limparPesquisa()">
            Limpar pesquisa
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- PAGINAÇÃO -->
  <div
    class="paginacao"
    *ngIf="totalPages > 1 && !termoPesquisa">

    <button
      type="button"
      class="btn-pag"
      [disabled]="page === 1"
      (click)="buscarUsuarios(page - 1)">
      « Anterior
    </button>

    <div class="numeros">
      <button
        type="button"
        *ngFor="let p of [].constructor(totalPages); let i = index"
        class="num"
        [class.ativo]="page === i + 1"
        (click)="buscarUsuarios(i + 1)">
        {{ i + 1 }}
      </button>
    </div>

    <button
      type="button"
      class="btn-pag"
      [disabled]="page === totalPages"
      (click)="buscarUsuarios(page + 1)">
      Próxima »
    </button>
  </div>

</div>
